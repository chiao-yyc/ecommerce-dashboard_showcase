# æ¥­å‹™å¥åº·åº¦æ´å¯Ÿç³»çµ±æ¶æ§‹æ–‡ä»¶

## æ–‡ä»¶è³‡è¨Š

- **å»ºç«‹æ—¥æœŸ**: 2025-10-01
- **æœ€å¾Œæ›´æ–°**: 2025-10-01
- **ç³»çµ±ç‰ˆæœ¬**: Phase 2 (Edge Function) + Phase 1.5 (Database Functions)
- **è² è²¬æ¨¡çµ„**: ç¶“ç‡Ÿå¥åº·åº¦ç¸½è¦½ã€é¢¨éšªé è­¦ä¸­å¿ƒã€æˆ°ç•¥æ±ºç­–æ”¯æ´

---

## ç³»çµ±æ¦‚è¿°

æ¥­å‹™å¥åº·åº¦æ´å¯Ÿç³»çµ±æ˜¯é›»å•†ç®¡ç†å¹³å°çš„æ ¸å¿ƒæ±ºç­–æ”¯æ´ç³»çµ±ï¼Œæä¾›ä¸‰å¤§æ ¸å¿ƒåŠŸèƒ½ï¼š

1. **é—œéµæ¥­å‹™æ´å¯Ÿ** (Business Insights) - åŸºæ–¼å¤šç¶­åº¦å¥åº·åº¦æŒ‡æ¨™çš„æ™ºèƒ½æ´å¯Ÿç”Ÿæˆ
2. **é¢¨éšªé è­¦ä¸­å¿ƒ** (Risk Alerts) - å¯¦æ™‚æ¥­å‹™é¢¨éšªç›£æ§èˆ‡é è­¦æ©Ÿåˆ¶
3. **æˆ°ç•¥è¡Œå‹•å»ºè­°** (Strategic Recommendations) - åŸºæ–¼è­¦ç¤ºçš„å¯åŸ·è¡Œè¡Œå‹•å»ºè­°

### ç³»çµ±ç‰¹è‰²

- ğŸ” **é›™å±¤æ¶æ§‹è¨­è¨ˆ**: Edge Function (å•†æ¥­é‚è¼¯ä¿è­·) + Database Functions (è¦å‰‡å¼•æ“)
- ğŸ“Š **å¤šç¶­åº¦åˆ†æ**: 7 å¤§æ¥­å‹™å¥åº·åº¦ç¶­åº¦ (ç‡Ÿæ”¶ã€å®¢æˆ¶ã€è¨‚å–®ã€å®¢æœã€ç”¢å“ã€è¡ŒéŠ·ã€ç³»çµ±)
- ğŸ¯ **æ™ºèƒ½åˆ¤æ–·**: è‡ªå‹•é–¾å€¼æ¯”å°ã€è¶¨å‹¢åˆ†æã€å„ªå…ˆç´šæ’åº
- ğŸ”„ **å³æ™‚æ›´æ–°**: æ•´åˆ Realtime è­¦å ±ç³»çµ±ï¼Œæ”¯æ´å³æ™‚ç›£æ§
- ğŸ¤– **AI å¢å¼·**: æ”¯æ´ AI è­¦å ±åˆ†æèˆ‡å»ºè­°å„ªåŒ–

---

## ç³»çµ±æ¶æ§‹

### æ•´é«”æ¶æ§‹åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å‰ç«¯ Vue çµ„ä»¶å±¤                            â”‚
â”‚  DashboardExecutiveHealth.vue                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚é—œéµæ¥­å‹™æ´å¯Ÿ  â”‚  â”‚é¢¨éšªé è­¦ä¸­å¿ƒ  â”‚  â”‚æˆ°ç•¥è¡Œå‹•å»ºè­°  â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                  â”‚                  â”‚
          â”‚                  â”‚                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    API æœå‹™å±¤                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚BusinessHealthAnalyticsâ”‚ â”‚DashboardApiService   â”‚          â”‚
â”‚  â”‚Service                â”‚ â”‚                      â”‚          â”‚
â”‚  â”‚(Phase 2 å°è£)         â”‚ â”‚(Phase 1.5 å°è£)      â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚                          â”‚
              â”‚                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Phase 2: Edge Function   â”‚  â”‚ Phase 1.5: Database Functions â”‚
â”‚                             â”‚  â”‚                               â”‚
â”‚  business-health-analytics  â”‚  â”‚  - get_unified_dashboard_     â”‚
â”‚                             â”‚  â”‚    content()                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚  - generate_dashboard_alerts()â”‚
â”‚  â”‚generateBusiness    â”‚    â”‚  â”‚  - generate_strategic_        â”‚
â”‚  â”‚Insights()          â”‚    â”‚  â”‚    recommendations()          â”‚
â”‚  â”‚                    â”‚    â”‚  â”‚  - generate_business_insights()â”‚
â”‚  â”‚- å¥åº·åº¦è©•åˆ†        â”‚    â”‚  â”‚                               â”‚
â”‚  â”‚- è¶¨å‹¢åˆ†æ          â”‚    â”‚  â”‚  ä¾è³´è³‡æ–™è¡¨:                  â”‚
â”‚  â”‚- æ™ºèƒ½æ´å¯Ÿç”Ÿæˆ      â”‚    â”‚  â”‚  - dashboard_alerts           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚  - metric_thresholds          â”‚
â”‚                             â”‚  â”‚  - conversation_summary_daily â”‚
â”‚  å—ä¿è­·çš„å•†æ¥­é‚è¼¯ ğŸ”        â”‚  â”‚  - order_items                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  - inventories                â”‚
                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è³‡æ–™æµå‘

```
ä½¿ç”¨è€…è«‹æ±‚
    â†“
å‰ç«¯çµ„ä»¶ä¸¦è¡ŒæŸ¥è©¢
    â”œâ”€â”€â†’ Phase 2 Edge Function (æ¥­å‹™æ´å¯Ÿ)
    â”‚      â†“
    â”‚   è¨ˆç®— 7 ç¶­åº¦å¥åº·åº¦æŒ‡æ¨™
    â”‚      â†“
    â”‚   è¶¨å‹¢åˆ†æ (å¯é¸)
    â”‚      â†“
    â”‚   ç”Ÿæˆæ™ºèƒ½æ´å¯Ÿ (æœ€å¤š5å€‹)
    â”‚      â†“
    â”‚   è¿”å› insights[]
    â”‚
    â””â”€â”€â†’ Phase 1.5 Database Functions (è­¦ç¤º+å»ºè­°)
           â†“
        æª¢æŸ¥æŒ‡æ¨™é–¾å€¼
           â†“
        ç”Ÿæˆè­¦ç¤ºè¨˜éŒ„
           â†“
        åŸºæ–¼è­¦ç¤ºç”Ÿæˆå»ºè­°
           â†“
        è¿”å› { alerts[], recommendations[] }
    â†“
å‰ç«¯è³‡æ–™çµ„åˆ
    â”œâ”€â”€â†’ é—œéµæ¥­å‹™æ´å¯Ÿå€å¡Š
    â”œâ”€â”€â†’ é¢¨éšªé è­¦ä¸­å¿ƒå€å¡Š (å« AI å¢å¼·)
    â””â”€â”€â†’ æˆ°ç•¥è¡Œå‹•å»ºè­°å€å¡Š
    â†“
UI æ¸²æŸ“å±•ç¤º
```

---

## åŠŸèƒ½ä¸€ï¼šé—œéµæ¥­å‹™æ´å¯Ÿ (Business Insights)

### å¯¦ç¾ä½ç½®

- **Edge Function**: `/supabase/functions/business-health-analytics/index.ts` (line 435-536)
- **å‡½æ•¸åç¨±**: `generateBusinessInsights()`
- **å‰ç«¯çµ„ä»¶**: `DashboardExecutiveHealth.vue` (line 701-815)

### æ¼”ç®—æ³•é‚è¼¯

#### è¼¸å…¥åƒæ•¸

```typescript
interface InputParams {
  metrics: BusinessHealthMetrics        // 7 ç¶­åº¦å¥åº·åº¦æŒ‡æ¨™
  scoreDetails: HealthScoreDetails      // ç¶œåˆè©•åˆ†ç´°ç¯€
  trends: TrendAnalysis | null          // è¶¨å‹¢åˆ†æè³‡æ–™ï¼ˆå¯é¸ï¼‰
}
```

#### åˆ¤æ–·è¦å‰‡çŸ©é™£

| æ¢ä»¶é¡å‹ | åˆ¤æ–·é‚è¼¯ | æ´å¯Ÿé¡å‹ | å½±éŸ¿ç¨‹åº¦ | ä¿¡å¿ƒåº¦ |
|---------|---------|---------|---------|--------|
| æ•´é«”å¥åº·åº¦å„ªç•° | `overallScore >= 90` | opportunity | low | 0.95 |
| æ•´é«”å¥åº·åº¦å¾…æ”¹å–„ | `overallScore <= 60` | warning | high | 0.90 |
| ç³»çµ±ç©©å®šåº¦è­¦å‘Š | `metrics.system < 7.0` | warning | high | 0.85 |
| æ¥­å‹™æŒ‡æ¨™ä¸‹æ»‘ | `trends.direction='ä¸‹é™' AND change > 5` | warning | high | 0.88 |
| æ¥­å‹™æˆé•·å¼·å‹ | `trends.direction='ä¸Šå‡' AND change > 10` | opportunity | medium | 0.90 |
| å®¢æœæ•ˆèƒ½ä¸ä½³ | `metrics.support < 5.0` | info | medium | 0.80 |
| ç‡Ÿæ”¶è¡¨ç¾ä¸ä½³ | `metrics.revenue < 6.0` | warning | high | 0.87 |

#### æ´å¯Ÿç”Ÿæˆæµç¨‹

```javascript
function generateBusinessInsights(metrics, scoreDetails, trends) {
  const insights = []

  // 1. æ•´é«”å¥åº·åº¦æ´å¯Ÿ
  if (scoreDetails.overallScore >= 90) {
    insights.push({
      title: 'æ¥­å‹™è¡¨ç¾å„ªç•°',
      description: `æ•´é«”å¥åº·åº¦é”åˆ° ${scoreDetails.overallScore} åˆ†ï¼Œç³»çµ±é‹è¡Œç‹€æ³è‰¯å¥½`,
      type: 'opportunity',
      impact: 'low',
      confidence: 0.95,
      category: 'æ¥­å‹™åˆ†æ',
      actions: ['æŒçºŒç›£æ§é—œéµæŒ‡æ¨™', 'æ“´å¤§æˆåŠŸç­–ç•¥æ‡‰ç”¨']
    })
  } else if (scoreDetails.overallScore <= 60) {
    insights.push({
      title: 'æ¥­å‹™å¥åº·åº¦éœ€æ”¹å–„',
      description: `æ•´é«”å¥åº·åº¦åƒ… ${scoreDetails.overallScore} åˆ†ï¼Œå»ºè­°å„ªå…ˆæ”¹å–„é—œéµæŒ‡æ¨™`,
      type: 'warning',
      impact: 'high',
      confidence: 0.9,
      category: 'é¢¨éšªç®¡ç†',
      actions: ['æª¢è¦–ç‡Ÿé‹æµç¨‹', 'æ”¹å–„å®¢æˆ¶é«”é©—', 'å„ªåŒ–æ”¯æ´æ•ˆç‡']
    })
  }

  // 2. ç³»çµ±ç©©å®šåº¦æ´å¯Ÿ
  if (metrics.system < 7.0) {
    insights.push({
      title: 'ç³»çµ±ç©©å®šåº¦è­¦å‘Š',
      description: `ç³»çµ±ç©©å®šåº¦ ${metrics.system.toFixed(1)} åˆ†ä½æ–¼æ¨™æº–ï¼Œå¯èƒ½å½±éŸ¿æ¥­å‹™é‹è¡Œ`,
      type: 'warning',
      impact: 'high',
      confidence: 0.85,
      category: 'æŠ€è¡“ç›£æ§',
      actions: ['æª¢æŸ¥ç³»çµ±æ¨¡çµ„ç‹€æ…‹', 'åŸ·è¡Œæ•…éšœæ’é™¤', 'å¼·åŒ–ç›£æ§æ©Ÿåˆ¶']
    })
  }

  // 3. è¶¨å‹¢åˆ†ææ´å¯Ÿ
  if (trends && trends.direction === 'ä¸‹é™' && trends.change > 5) {
    insights.push({
      title: 'æ¥­å‹™æŒ‡æ¨™ä¸‹æ»‘è¶¨å‹¢',
      description: `æª¢æ¸¬åˆ°æ¥­å‹™æŒ‡æ¨™ä¸‹é™ ${trends.change.toFixed(1)}%ï¼Œéœ€è¦ç«‹å³é—œæ³¨`,
      type: 'warning',
      impact: 'high',
      confidence: 0.88,
      category: 'è¶¨å‹¢åˆ†æ',
      actions: ['åˆ†æä¸‹é™åŸå› ', 'åˆ¶å®šæ”¹å–„è¨ˆåŠƒ', 'åŠ å¼·ç›£æ§é »ç‡']
    })
  } else if (trends && trends.direction === 'ä¸Šå‡' && trends.change > 10) {
    insights.push({
      title: 'æ¥­å‹™æˆé•·å‹•èƒ½å¼·å‹',
      description: `æ¥­å‹™æŒ‡æ¨™ä¸Šå‡ ${trends.change.toFixed(1)}%ï¼Œè¡¨ç¾å„ªæ–¼é æœŸ`,
      type: 'opportunity',
      impact: 'medium',
      confidence: 0.9,
      category: 'æˆé•·æ©Ÿæœƒ',
      actions: ['åˆ†ææˆåŠŸå› ç´ ', 'æ“´å¤§å„ªå‹¢ç­–ç•¥', 'è¨­å®šæ›´é«˜ç›®æ¨™']
    })
  }

  // 4. æ¨¡çµ„æ•ˆèƒ½æ´å¯Ÿ
  if (metrics.support < 5.0) {
    insights.push({
      title: 'å®¢æœæ•ˆèƒ½å¾…æ”¹å–„',
      description: `å®¢æœå¥åº·åº¦ ${metrics.support.toFixed(1)} åˆ†ï¼Œå¯èƒ½å½±éŸ¿å®¢æˆ¶æ»¿æ„åº¦`,
      type: 'info',
      impact: 'medium',
      confidence: 0.8,
      category: 'å®¢æˆ¶æœå‹™',
      actions: ['å„ªåŒ–å›æ‡‰æ™‚é–“', 'åŸ¹è¨“å®¢æœäººå“¡', 'æ”¹å–„æœå‹™æµç¨‹']
    })
  }

  if (metrics.revenue < 6.0) {
    insights.push({
      title: 'ç‡Ÿæ”¶è¡¨ç¾éœ€é—œæ³¨',
      description: `ç‡Ÿæ”¶å¥åº·åº¦ ${metrics.revenue.toFixed(1)} åˆ†ï¼Œå»ºè­°æª¢è¦–è¨‚å–®æµç¨‹`,
      type: 'warning',
      impact: 'high',
      confidence: 0.87,
      category: 'è²¡å‹™åˆ†æ',
      actions: ['åˆ†æè¨‚å–®è½‰æ›ç‡', 'å„ªåŒ–ä»˜æ¬¾æµç¨‹', 'æå‡ç”¢å“ç«¶çˆ­åŠ›']
    })
  }

  // é™åˆ¶æœ€å¤šè¿”å› 5 å€‹æ´å¯Ÿ
  return insights.slice(0, 5)
}
```

#### è¼¸å‡ºæ ¼å¼

```typescript
interface BusinessInsight {
  title: string              // æ´å¯Ÿæ¨™é¡Œ (ç°¡æ½”æè¿°)
  description: string        // è©³ç´°èªªæ˜ (åŒ…å«å…·é«”æ•¸å€¼)
  type: 'warning' | 'info' | 'opportunity'  // æ´å¯Ÿé¡å‹
  impact: 'high' | 'medium' | 'low'         // å½±éŸ¿ç¨‹åº¦
  confidence: number         // ä¿¡å¿ƒåº¦ (0.00-1.00)
  category: string           // åˆ†é¡æ¨™ç±¤
  actions: string[]          // å»ºè­°è¡Œå‹•æ¸…å–® (2-3 é …)
}
```

### å¥åº·åº¦è¨ˆç®—ä¾æ“š

#### 7 ç¶­åº¦å¥åº·åº¦æŒ‡æ¨™

```typescript
interface BusinessHealthMetrics {
  revenue: number       // ç‡Ÿæ”¶æˆé•· (0-10) - åŸºæ–¼ order_summary ç‡Ÿæ”¶è¶¨å‹¢
  satisfaction: number  // å®¢æˆ¶æ»¿æ„ (0-10) - åŸºæ–¼ conversation_summary è§£æ±ºç‡
  fulfillment: number   // è¨‚å–®å±¥è¡Œ (0-10) - åŸºæ–¼ order_summary å®Œæˆç‡
  support: number       // å®¢æœæ•ˆç‡ (0-10) - åŸºæ–¼ tickets å›æ‡‰æ™‚é–“
  products: number      // ç”¢å“ç®¡ç† (0-10) - åŸºæ–¼ inventories åº«å­˜å¥åº·åº¦
  marketing: number     // è¡ŒéŠ·æ•ˆæœ (0-10) - é ç•™æ¬„ä½
  system: number        // ç³»çµ±ç©©å®šåº¦ (0-10) - åŸºæ–¼ Realtime è­¦å ±ç‹€æ…‹
}
```

#### ç¶œåˆè©•åˆ†è¨ˆç®—

```typescript
interface HealthScoreDetails {
  customerQuality: number        // å®¢æˆ¶å“è³ª (0-100) = RFM å¹³å‡åˆ†æ•¸ Ã— 10
  operationalEfficiency: number  // ç‡Ÿé‹æ•ˆç‡ (0-100) = è¨‚å–®å®Œæˆç‡ Ã— 100
  supportEffectiveness: number   // å®¢æœæ•ˆèƒ½ (0-100) = (è§£æ±ºç‡Ã—0.7 + å›æ‡‰æ™‚é–“åˆ†æ•¸Ã—0.3) Ã— 100
  overallScore: number           // ç¸½åˆ† (0-100) = (ä¸‰é …åŠ ç¸½) / 3
  rating: string                 // è©•ç´š: å„ªç§€/è‰¯å¥½/æ™®é€š/éœ€æ”¹å–„/å¾…åŠ å¼·
}
```

#### è©•ç´šåˆ¤å®šé‚è¼¯

```typescript
function getRatingFromScore(score: number): string {
  if (score >= 90) return 'å„ªç§€'
  if (score >= 75) return 'è‰¯å¥½'
  if (score >= 60) return 'æ™®é€š'
  if (score >= 40) return 'éœ€æ”¹å–„'
  return 'å¾…åŠ å¼·'
}
```

### è¶¨å‹¢åˆ†æé‚è¼¯

```typescript
interface TrendAnalysis {
  direction: 'ä¸Šå‡' | 'ä¸‹é™' | 'æŒå¹³'  // è¶¨å‹¢æ–¹å‘
  change: number                      // è®ŠåŒ–å¹…åº¦ (ç™¾åˆ†æ¯”)
  description: string                 // è¶¨å‹¢æè¿°
  customerChange: number              // å®¢æˆ¶å“è³ªè®ŠåŒ–
  operationalChange: number           // ç‡Ÿé‹æ•ˆç‡è®ŠåŒ–
}

// è¨ˆç®—é‚è¼¯
function calculateTrendAnalysis(current, previous) {
  const customerChange = (current.customerQuality - previous.customerQuality) * 100
  const operationalChange = (current.operationalEfficiency - previous.operationalEfficiency) * 100
  const avgChange = (customerChange + operationalChange) / 2

  return {
    direction: avgChange > 2 ? 'ä¸Šå‡' : avgChange < -2 ? 'ä¸‹é™' : 'æŒå¹³',
    change: Math.abs(avgChange),
    description: avgChange > 2 ? 'æ¥­å‹™è¡¨ç¾æŒçºŒæ”¹å–„'
                 : avgChange < -2 ? 'éœ€è¦é—œæ³¨æ¥­å‹™æŒ‡æ¨™ä¸‹æ»‘'
                 : 'æ¥­å‹™è¡¨ç¾ç©©å®š',
    customerChange,
    operationalChange
  }
}
```

---

## ğŸš¨ åŠŸèƒ½äºŒï¼šé¢¨éšªé è­¦ä¸­å¿ƒ (Risk Alerts)

### é›™å±¤å¯¦ç¾æ¶æ§‹

#### Phase 1.5: è³‡æ–™åº«å±¤ (æŒ‡æ¨™è­¦å ±)

**Migration æª”æ¡ˆ**:
- `20250806104000_unify_alert_and_recommendation_logic.sql`
- `20250806103000_extend_alert_types.sql`
- `20250826150000_fix_unified_dashboard_alerts.sql`

**æ ¸å¿ƒå‡½æ•¸**: `generate_dashboard_alerts()`

**è³‡æ–™è¡¨çµæ§‹**:

```sql
CREATE TABLE dashboard_alerts (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    alert_type VARCHAR(50) NOT NULL,
    title VARCHAR(200) NOT NULL,
    message TEXT NOT NULL,
    severity VARCHAR(20) CHECK (severity IN ('info', 'warning', 'critical')),
    metric_name VARCHAR(100),
    current_value DECIMAL,
    threshold_value DECIMAL,
    business_context JSONB,
    detected_at TIMESTAMP DEFAULT NOW(),
    created_at TIMESTAMP DEFAULT NOW(),
    resolved_at TIMESTAMP,
    expires_at TIMESTAMP,
    is_active BOOLEAN DEFAULT TRUE,
    is_resolved BOOLEAN DEFAULT FALSE,
    ai_suggestion TEXT,
    ai_confidence DECIMAL(3,2),
    confidence_score DECIMAL(3,2),
    trend_direction VARCHAR(20),
    trend_period VARCHAR(50)
);

CREATE TABLE metric_thresholds (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    metric_name VARCHAR(100) UNIQUE NOT NULL,
    display_name VARCHAR(200) NOT NULL,
    category VARCHAR(50),
    threshold_value DECIMAL NOT NULL,
    comparison_operator VARCHAR(10) CHECK (operator IN ('>', '<', '>=', '<=', '=')),
    severity VARCHAR(20) CHECK (severity IN ('info', 'warning', 'critical')),
    is_higher_better BOOLEAN DEFAULT TRUE,
    alert_message_template TEXT,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);
```

**è­¦å ±ç”Ÿæˆé‚è¼¯**:

```sql
-- åŸºæ–¼æŒ‡æ¨™é–¾å€¼è‡ªå‹•ç”Ÿæˆè­¦å ±
FOR metric IN SELECT * FROM metric_thresholds WHERE is_active = TRUE
LOOP
    -- æŸ¥è©¢ç•¶å‰æŒ‡æ¨™å€¼
    EXECUTE format('SELECT %s FROM %s WHERE %s',
                   metric.metric_column,
                   metric.source_table,
                   metric.filter_condition)
    INTO current_value;

    -- åˆ¤æ–·æ˜¯å¦è¶…éé–¾å€¼
    IF evaluate_threshold(current_value, metric.threshold_value, metric.comparison_operator) THEN
        INSERT INTO dashboard_alerts (
            alert_type, title, message, severity,
            metric_name, current_value, threshold_value,
            business_context, confidence_score
        ) VALUES (
            metric.alert_type,
            format(metric.alert_title_template, current_value),
            format(metric.alert_message_template, current_value, metric.threshold_value),
            metric.severity,
            metric.metric_name,
            current_value,
            metric.threshold_value,
            jsonb_build_object('category', metric.category),
            metric.default_confidence
        )
        ON CONFLICT (metric_name, detected_at::DATE) DO UPDATE
        SET current_value = EXCLUDED.current_value,
            updated_at = NOW();
    END IF;
END LOOP;
```

#### Phase 1.5+: å‰ç«¯çµ„åˆå±¤ (å¤šä¾†æºæ•´åˆ)

**å¯¦ç¾ä½ç½®**: `DashboardApiService.ts` (line 668-909)

**è³‡æ–™ä¾†æºçµ„åˆ**:

```typescript
async getSystemAlerts(): Promise<ApiResponse<SystemAlert[]>> {
  const alerts: SystemAlert[] = []

  // 1. Realtime è­¦å ± (ç³»çµ±ç©©å®šåº¦)
  const realtimeAlerts = getGlobalRealtimeAlerts().getRealtimeAlerts()
  alerts.push(...realtimeAlerts)

  // 2. åº«å­˜è­¦å ±
  const inventoryAlerts = await this.getInventoryAlerts(timestamp)
  alerts.push(...inventoryAlerts)

  // 3. å®¢æœè­¦å ±
  const supportAlerts = await this.getSupportAlerts(timestamp)
  alerts.push(...supportAlerts)

  // 4. è¨‚å–®è­¦å ±
  const orderAlerts = await this.getOrderAlerts(timestamp)
  alerts.push(...orderAlerts)

  // å„ªå…ˆç´šæ’åº: error > warning > info > success
  alerts.sort((a, b) => priorityOrder[a.type] - priorityOrder[b.type])

  // é™åˆ¶é¡¯ç¤ºæ•¸é‡ (æœ€å¤š 8 å€‹)
  return alerts.slice(0, 8)
}
```

**å„é¡è­¦å ±åˆ¤æ–·é‚è¼¯**:

##### åº«å­˜è­¦å ±

```typescript
private async getInventoryAlerts(timestamp: string): Promise<SystemAlert[]> {
  const alerts: SystemAlert[] = []
  const { data } = await this.supabase.rpc('get_inventory_overview')

  // ç¼ºè²¨è­¦å ± (æœ€é«˜å„ªå…ˆç´š)
  if (data?.out_of_stock_count > 0) {
    alerts.push({
      id: 'out-of-stock-alert',
      type: 'error',
      message: `ç·Šæ€¥ï¼š${data.out_of_stock_count} é …å•†å“ç¼ºè²¨`,
      priority: 'high',
      timestamp
    })
  }

  // åº«å­˜ä¸è¶³è­¦å ±
  if (data?.low_stock_count > 0) {
    alerts.push({
      id: 'low-stock-alert',
      type: 'warning',
      message: `æ³¨æ„ï¼š${data.low_stock_count} é …å•†å“åº«å­˜åä½`,
      priority: 'medium',
      timestamp
    })
  }

  // åº«å­˜å¥åº·ç‹€æ³ (æ­£é¢å›é¥‹)
  if (data?.healthy_stock_count > 0 && alerts.length === 0) {
    alerts.push({
      id: 'healthy-stock-info',
      type: 'success',
      message: `æ­£å¸¸ï¼š${data.healthy_stock_count} é …å•†å“åº«å­˜å……è¶³`,
      priority: 'low',
      timestamp
    })
  }

  return alerts
}
```

##### å®¢æœè­¦å ±

```typescript
private async getSupportAlerts(timestamp: string): Promise<SystemAlert[]> {
  const alerts: SystemAlert[] = []

  // æŸ¥è©¢æœ€è¿‘ 7 å¤©å®¢æœæ•¸æ“š
  const { data } = await this.supabase
    .from('conversation_summary_daily')
    .select('conversation_date, total_conversations, avg_first_response_minutes')
    .gte('conversation_date', sevenDaysAgo)
    .order('conversation_date', { ascending: false })

  if (data && data.length > 0) {
    const totalConversations = data.reduce((sum, day) => sum + day.total_conversations, 0)
    const avgResponseMinutes = data.reduce((sum, day) =>
      sum + day.avg_first_response_minutes, 0) / data.length

    // å›æ‡‰æ™‚é–“è­¦å ±
    if (avgResponseMinutes > 120) {  // è¶…é 2 å°æ™‚
      alerts.push({
        id: 'slow-response-alert',
        type: 'warning',
        message: `å®¢æœå›æ‡‰ï¼šå¹³å‡ ${avgResponseMinutes.toFixed(0)} åˆ†é˜`,
        priority: 'medium',
        timestamp
      })
    } else if (avgResponseMinutes > 0 && avgResponseMinutes <= 60) {
      alerts.push({
        id: 'good-response-info',
        type: 'success',
        message: `å®¢æœå›æ‡‰ï¼šå¹³å‡ ${avgResponseMinutes.toFixed(0)} åˆ†é˜`,
        priority: 'low',
        timestamp
      })
    }

    // å®¢æœå·¥ä½œé‡æé†’
    if (totalConversations > 0) {
      alerts.push({
        id: 'support-activity-info',
        type: 'info',
        message: `æœ¬é€±è™•ç† ${totalConversations} å€‹å®¢æœå°è©±`,
        priority: 'low',
        timestamp
      })
    }
  }

  return alerts
}
```

##### è¨‚å–®è­¦å ±

```typescript
private async getOrderAlerts(timestamp: string): Promise<SystemAlert[]> {
  const alerts: SystemAlert[] = []

  // æª¢æŸ¥å¾…è™•ç†è¨‚å–® (è¶…é 2 å°æ™‚æœªè™•ç†)
  const { count: pendingCount } = await this.supabase
    .from('orders')
    .select('*', { count: 'exact', head: true })
    .in('status', ['pending', 'confirmed'])
    .lte('created_at', new Date(Date.now() - 2 * 60 * 60 * 1000).toISOString())

  if (pendingCount && pendingCount > 0) {
    alerts.push({
      id: 'pending-orders-alert',
      type: 'warning',
      message: `å¾…è™•ç†ï¼š${pendingCount} å€‹è¨‚å–®è¶…é 2 å°æ™‚`,
      priority: 'high',
      timestamp
    })
  }

  // ä»Šæ—¥è¨‚å–®æ´»å‹•
  const { data: todayOrders } = await this.supabase
    .from('orders')
    .select('status')
    .gte('created_at', new Date().toISOString().split('T')[0])

  if (todayOrders) {
    const completedToday = todayOrders.filter(o =>
      ['completed', 'delivered'].includes(o.status)).length

    if (completedToday > 0) {
      alerts.push({
        id: 'daily-orders-info',
        type: 'info',
        message: `ä»Šæ—¥å®Œæˆ ${completedToday} å€‹è¨‚å–®`,
        priority: 'low',
        timestamp
      })
    }
  }

  return alerts
}
```

### è­¦å ±è¼¸å‡ºæ ¼å¼

```typescript
interface SystemAlert {
  id: string
  type: 'error' | 'warning' | 'info' | 'success'
  message: string
  priority: 'high' | 'medium' | 'low'
  timestamp: string
}

interface DashboardAlert extends SystemAlert {
  alert_type: string
  title: string
  description?: string
  severity: 'info' | 'warning' | 'critical'
  metric_name?: string
  current_value?: number
  threshold_value?: number
  business_context?: Record<string, any>
  detected_at?: string
  ai_suggestion?: string
  ai_confidence?: number
  confidence_score?: number
  trend_direction?: string
  trend_period?: string
}
```

### å‰ç«¯é¡¯ç¤ºé‚è¼¯

```typescript
// çµ„ä»¶: DashboardExecutiveHealth.vue (line 269-293)
const criticalAlerts = computed(() => {
  const unifiedData = unifiedContentQuery.data.value
  const fullAlertsData = dashboardAlertsQuery.data.value || []

  if (!unifiedData?.alerts) return []

  // å°‡çµ±åˆ API çš„æ ¼å¼åŒ–è³‡æ–™æ˜ å°„åˆ°å®Œæ•´è­¦ç¤º
  return unifiedData.alerts.map(alert => {
    const fullAlert = fullAlertsData.find(fa => fa.id === alert.id)

    return {
      type: alert.type || (alert.severity === 'critical' ? 'warning' :
        alert.severity === 'warning' ? 'info' : 'success'),
      title: alert.title,
      message: alert.message,
      priority: alert.priority || (alert.severity === 'critical' ? 'high' :
        alert.severity === 'warning' ? 'medium' : 'low'),
      action: alert.action || `æª¢è¦–è©³æƒ…`,
      _original: fullAlert || alert  // å®Œæ•´è³‡æ–™ä¾› AI åˆ†æä½¿ç”¨
    }
  })
})
```

---

## åŠŸèƒ½ä¸‰ï¼šæˆ°ç•¥è¡Œå‹•å»ºè­° (Strategic Recommendations)

### å¯¦ç¾ä½ç½®

- **Migration**: `20250806105000_fix_concise_recommendations.sql`
- **å‡½æ•¸**: `generate_strategic_recommendations()`
- **å‰ç«¯çµ„ä»¶**: `DashboardExecutiveHealth.vue` (line 875-940)

### å»ºè­°ç”Ÿæˆé‚è¼¯

#### è¼¸å…¥è³‡æ–™ä¾†æº

```sql
-- åŸºæ–¼ç¾æœ‰è­¦ç¤ºç”Ÿæˆå»ºè­°
SELECT da.*, mt.category, mt.display_name, mt.is_higher_better
FROM dashboard_alerts da
LEFT JOIN metric_thresholds mt ON da.metric_name = mt.metric_name
WHERE da.is_active = TRUE
  AND da.is_resolved = FALSE
  AND da.severity IN ('critical', 'warning')
ORDER BY da.severity DESC, da.detected_at DESC
LIMIT 5
```

#### å»ºè­°è¦å‰‡å°ç…§è¡¨

| metric_name | å»ºè­°é¡å‹ | å»ºè­°æ¨™é¡Œ | å½±éŸ¿ç¨‹åº¦ | å·¥ä½œé‡ | å„ªå…ˆç´š | æ™‚é–“è»¸ |
|------------|---------|---------|---------|--------|--------|--------|
| customer_churn_rate | customer_retention | å•Ÿå‹•å®¢æˆ¶æµå¤±é é˜²è¨ˆåŠƒ | high | high | 95 | ç·Šæ€¥ï¼ˆ2-4é€±ï¼‰ |
| high_value_customer_count | customer_acquisition | é‡å»ºé«˜åƒ¹å€¼å®¢æˆ¶ç¾¤ | high | high | 90 | ä¸­æœŸï¼ˆ2-3å€‹æœˆï¼‰ |
| business_momentum_trend | business_turnaround | æ¥­å‹™å‹•èƒ½å¾©ç”¦è¡Œå‹• | high | high | 100 | ç«‹å³åŸ·è¡Œï¼ˆ1-2å€‹æœˆï¼‰ |
| customer_growth_trend | growth_recovery | å®¢æˆ¶æˆé•·ç­–ç•¥èª¿æ•´ | high | medium | 85 | çŸ­ä¸­æœŸï¼ˆ6-12é€±ï¼‰ |
| avg_response_time | operational_improvement | æ”¹å–„å®¢æœå›æ‡‰æ•ˆç‡ | high | medium | 85 | 2-4é€± |
| order_completion_rate | process_optimization | è¨‚å–®è™•ç†æµç¨‹å„ªåŒ– | medium | medium | 75 | 3-6é€± |
| inventory_stockout_count | inventory_management | åº«å­˜è£œè²¨ç­–ç•¥å„ªåŒ– | medium | medium | 70 | 2-4é€± |
| (å…¶ä»–) | general_improvement | ç³»çµ±ç›£æ§å„ªåŒ– | medium | low | 60 | çŸ­æœŸï¼ˆ2-4é€±ï¼‰ |

#### å»ºè­°ç”Ÿæˆç¯„ä¾‹

```sql
-- ç¯„ä¾‹ï¼šå®¢æˆ¶æµå¤±ç‡è­¦ç¤º â†’ ç”Ÿæˆå»ºè­°
IF current_alerts.metric_name = 'customer_churn_rate' THEN
    RETURN QUERY SELECT
        'customer_retention'::VARCHAR(50) as recommendation_type,
        'å®¢æˆ¶åƒ¹å€¼'::VARCHAR(50) as category,
        'å•Ÿå‹•å®¢æˆ¶æµå¤±é é˜²è¨ˆåŠƒ'::VARCHAR(200) as title,
        format('ç•¶å‰å®¢æˆ¶æµå¤±ç‡%sï¼Œå»ºè­°ç«‹å³æª¢è¨å®¢æˆ¶æ»¿æ„åº¦ä¸¦å•Ÿå‹•æŒ½å›è¨ˆåŠƒã€‚',
               format_metric_value(current_alerts.current_value, 'percentage'))::TEXT as description,
        'high'::VARCHAR(20) as impact_level,
        'high'::VARCHAR(20) as effort_level,
        95::INTEGER as priority_score,
        0.90::DECIMAL(3,2) as confidence_score,
        jsonb_build_object(
            'source_alert_id', current_alerts.id,
            'current_value', current_alerts.current_value,
            'impact', 'ç‡Ÿæ”¶ä¿è­·'
        )::JSONB as business_context,
        'ç·Šæ€¥ï¼ˆ2-4é€±ï¼‰'::VARCHAR(50) as estimated_timeline;
END IF;

-- ç¯„ä¾‹ï¼šæ¥­å‹™å‹•èƒ½è¶¨å‹¢è­¦ç¤º â†’ ç”Ÿæˆå»ºè­°
ELSIF current_alerts.metric_name = 'business_momentum_trend' THEN
    RETURN QUERY SELECT
        'business_turnaround'::VARCHAR(50),
        'ç‡Ÿé‹ç­–ç•¥'::VARCHAR(50),
        'æ¥­å‹™å‹•èƒ½å¾©ç”¦è¡Œå‹•'::VARCHAR(200),
        format('æ¥­å‹™å‹•èƒ½%s%sï¼Œå»ºè­°æˆç«‹å°ˆæ¡ˆå°çµ„é€²è¡Œå¸‚å ´åˆ†æä¸¦åˆ¶å®šæ”¹å–„è¨ˆåŠƒã€‚',
               COALESCE(current_alerts.trend_direction, 'è®ŠåŒ–'),
               format_metric_value(ABS(current_alerts.current_value), 'percentage'))::TEXT,
        'high'::VARCHAR(20),
        'high'::VARCHAR(20),
        100::INTEGER,
        0.88::DECIMAL(3,2),
        jsonb_build_object(
            'source_alert_id', current_alerts.id,
            'priority', 'CEOç›´æ¥ç›£ç£'
        )::JSONB,
        'ç«‹å³åŸ·è¡Œï¼ˆ1-2å€‹æœˆï¼‰'::VARCHAR(50);
END IF;
```

### è¼¸å‡ºæ ¼å¼

```typescript
interface StrategicRecommendation {
  recommendation_type: string      // å»ºè­°é¡å‹ (customer_retention, business_turnaround ç­‰)
  category: string                 // åˆ†é¡æ¨™ç±¤ (å®¢æˆ¶åƒ¹å€¼ã€ç‡Ÿé‹ç­–ç•¥ç­‰)
  title: string                    // å»ºè­°æ¨™é¡Œ (ç°¡æ½”)
  description: string              // è©³ç´°èªªæ˜ (å«ç•¶å‰å€¼)
  impact_level: 'high' | 'medium' | 'low'    // å½±éŸ¿ç¨‹åº¦
  effort_level: 'high' | 'medium' | 'low'    // æ‰€éœ€å·¥ä½œé‡
  priority_score: number           // å„ªå…ˆç´šåˆ†æ•¸ (0-100)
  confidence_score: number         // ä¿¡å¿ƒåº¦ (0.00-1.00)
  business_context: {              // æ¥­å‹™è„ˆçµ¡
    source_alert_id: string        // ä¾†æºè­¦ç¤º ID
    current_value?: number         // ç•¶å‰æŒ‡æ¨™å€¼
    target_value?: number          // ç›®æ¨™å€¼
    expected_roi?: string          // é æœŸæŠ•è³‡å›å ±ç‡
    priority?: string              // ç‰¹æ®Šå„ªå…ˆç´šæ¨™è¨˜
  }
  estimated_timeline: string       // é è¨ˆæ™‚é–“è»¸ (ç·Šæ€¥/çŸ­æœŸ/ä¸­æœŸ/é•·æœŸ)
}
```

### å‰ç«¯é¡¯ç¤ºé‚è¼¯

```typescript
// çµ„ä»¶: DashboardExecutiveHealth.vue (line 296-310)
const businessRecommendations = computed(() => {
  const unifiedData = unifiedContentQuery.data.value
  if (!unifiedData?.recommendations) {
    return []
  }

  return unifiedData.recommendations.map(rec => ({
    category: rec.category,
    title: rec.title,
    description: rec.description,
    impact: rec.impact_level,
    effort: rec.effort_level,
    priority: rec.priority_score,
    timeline: rec.estimated_timeline,
    context: rec.business_context
  }))
})
```

---

## ğŸ”„ è³‡æ–™æµèˆ‡ API æ•´åˆ

### API å‘¼å«æµç¨‹

#### å‰ç«¯çµ„ä»¶åˆå§‹åŒ–

```typescript
// DashboardExecutiveHealth.vue
// Phase 2: å—ä¿è­·çš„æ¥­å‹™å¥åº·åº¦åˆ†æ Edge Function
const protectedHealthQuery = useCompleteDashboardHealth('30d')

// Phase 1.5: çµ±åˆçš„å„€è¡¨æ¿å…§å®¹ï¼ˆè­¦ç¤ºå’Œå»ºè­°ï¼‰
const unifiedContentQuery = useUnifiedDashboardContent()

// å®Œæ•´çš„è­¦ç¤ºæ•¸æ“šä¾› AI åˆ†æä½¿ç”¨
const dashboardAlertsQuery = useDashboardAlerts()
```

#### Composable å±¤

```typescript
// useBusinessHealthAnalyticsQueries.ts
export function useCompleteDashboardHealth(period: '7d' | '30d' | '90d' = '30d') {
  return useQuery({
    queryKey: ['business-health-analytics', period],
    queryFn: async () => {
      const service = defaultServiceFactory.getBusinessHealthAnalyticsService()
      return await service.getBusinessHealthAnalysis({
        period,
        includeSystemHealth: true,
        includeTrends: true,
        includeInsights: true
      })
    },
    staleTime: 5 * 60 * 1000,  // 5 åˆ†é˜
    gcTime: 10 * 60 * 1000     // 10 åˆ†é˜
  })
}

// useBusinessHealthQueries.ts
export function useUnifiedDashboardContent() {
  return useQuery({
    queryKey: ['unified-dashboard-content'],
    queryFn: async () => {
      const { data, error } = await supabase.rpc('get_unified_dashboard_content')
      if (error) throw error
      return data
    },
    staleTime: 2 * 60 * 1000,  // 2 åˆ†é˜
    gcTime: 5 * 60 * 1000      // 5 åˆ†é˜
  })
}
```

#### API Service å±¤

```typescript
// BusinessHealthAnalyticsService.ts
export class BusinessHealthAnalyticsService extends BaseApiService {
  async getBusinessHealthAnalysis(
    request: BusinessHealthRequest = {}
  ): Promise<BusinessHealthResponse> {
    const params = {
      period: request.period || '30d',
      includeSystemHealth: request.includeSystemHealth ?? true,
      includeTrends: request.includeTrends ?? true,
      includeInsights: request.includeInsights ?? true,
      ...request
    }

    // èª¿ç”¨å—ä¿è­·çš„å•†æ¥­é‚è¼¯ Edge Function
    const { data, error } = await this.supabase.functions.invoke(
      'business-health-analytics',
      {
        body: params,
        headers: { 'Content-Type': 'application/json' }
      }
    )

    if (error) throw new Error(`Edge Function error: ${error.message}`)
    if (!data?.success) throw new Error(data?.error || 'æ¥­å‹™å¥åº·åº¦åˆ†æå¤±æ•—')

    return data
  }
}
```

### å®Œæ•´è«‹æ±‚/éŸ¿æ‡‰ç¯„ä¾‹

#### Phase 2 Edge Function è«‹æ±‚

```http
POST /functions/v1/business-health-analytics
Content-Type: application/json

{
  "period": "30d",
  "includeSystemHealth": true,
  "includeTrends": true,
  "includeInsights": true
}
```

#### Phase 2 Edge Function éŸ¿æ‡‰

```json
{
  "success": true,
  "data": {
    "metrics": {
      "revenue": 7.5,
      "satisfaction": 8.2,
      "fulfillment": 9.1,
      "support": 6.8,
      "products": 7.0,
      "marketing": 0,
      "system": 8.5
    },
    "scoreDetails": {
      "customerQuality": 75.5,
      "operationalEfficiency": 85.2,
      "supportEffectiveness": 72.3,
      "overallScore": 77.7,
      "rating": "è‰¯å¥½"
    },
    "trends": {
      "direction": "ä¸Šå‡",
      "change": 5.2,
      "description": "æ¥­å‹™è¡¨ç¾æŒçºŒæ”¹å–„",
      "customerChange": 3.5,
      "operationalChange": 6.8
    },
    "insights": [
      {
        "title": "æ¥­å‹™æˆé•·å‹•èƒ½å¼·å‹",
        "description": "æ¥­å‹™æŒ‡æ¨™ä¸Šå‡ 5.2%ï¼Œè¡¨ç¾å„ªæ–¼é æœŸ",
        "type": "opportunity",
        "impact": "medium",
        "confidence": 0.9,
        "category": "æˆé•·æ©Ÿæœƒ",
        "actions": [
          "åˆ†ææˆåŠŸå› ç´ ",
          "æ“´å¤§å„ªå‹¢ç­–ç•¥",
          "è¨­å®šæ›´é«˜ç›®æ¨™"
        ]
      },
      {
        "title": "å®¢æœæ•ˆèƒ½å¾…æ”¹å–„",
        "description": "å®¢æœå¥åº·åº¦ 6.8 åˆ†ï¼Œå¯èƒ½å½±éŸ¿å®¢æˆ¶æ»¿æ„åº¦",
        "type": "info",
        "impact": "medium",
        "confidence": 0.8,
        "category": "å®¢æˆ¶æœå‹™",
        "actions": [
          "å„ªåŒ–å›æ‡‰æ™‚é–“",
          "åŸ¹è¨“å®¢æœäººå“¡",
          "æ”¹å–„æœå‹™æµç¨‹"
        ]
      }
    ],
    "timestamp": "2025-10-01T06:00:00.000Z"
  }
}
```

#### Phase 1.5 Database Function è«‹æ±‚

```sql
SELECT * FROM get_unified_dashboard_content();
```

#### Phase 1.5 Database Function éŸ¿æ‡‰

```json
{
  "alerts": [
    {
      "id": "uuid-1",
      "alert_type": "inventory_alert",
      "title": "åº«å­˜ä¸è¶³è­¦ç¤º",
      "message": "æ³¨æ„ï¼š5 é …å•†å“åº«å­˜åä½",
      "severity": "warning",
      "metric_name": "low_stock_count",
      "current_value": 5,
      "threshold_value": 3,
      "detected_at": "2025-10-01T05:30:00.000Z",
      "confidence_score": 0.85
    }
  ],
  "recommendations": [
    {
      "recommendation_type": "inventory_management",
      "category": "åº«å­˜ç®¡ç†",
      "title": "åº«å­˜è£œè²¨ç­–ç•¥å„ªåŒ–",
      "description": "ç¼ºè²¨å•†å“5ä»¶ï¼Œå»ºè­°ç«‹å³æª¢è¨å®‰å…¨åº«å­˜è¨­å®šä¸¦å„ªåŒ–ä¾›æ‡‰å•†äº¤æœŸç®¡ç†ã€‚",
      "impact_level": "medium",
      "effort_level": "medium",
      "priority_score": 70,
      "confidence_score": 0.80,
      "business_context": {
        "source_alert_id": "uuid-1",
        "current_value": 5,
        "efficiency_improvement": "15-20%"
      },
      "estimated_timeline": "2-4é€±"
    }
  ],
  "insights": [
    {
      "insight_type": "stability_insight",
      "category": "ç³»çµ±ç©©å®š",
      "title": "æ¥­å‹™æŒ‡æ¨™é‹è¡Œç©©å®š",
      "description": "å„é …é—œéµæ¥­å‹™æŒ‡æ¨™å‡åœ¨æ­£å¸¸ç¯„åœå…§é‹è¡Œï¼Œå»ºè­°ä¿æŒç¾æœ‰ç­–ç•¥ä¸¦æŒçºŒç›£æ§å¸‚å ´è®ŠåŒ–ã€‚",
      "impact_level": "low",
      "confidence_score": 0.85,
      "business_context": { "status": "healthy" },
      "action_items": [
        "ç¶­æŒæˆåŠŸç­–ç•¥",
        "å®šæœŸæª¢è¦–æŒ‡æ¨™",
        "æº–å‚™æ‡‰å°è®ŠåŒ–",
        "æŒçºŒå„ªåŒ–é«”é©—"
      ]
    }
  ]
}
```

---

## ç³»çµ±é…ç½®èˆ‡é–¾å€¼è¨­å®š

### æŒ‡æ¨™é–¾å€¼é…ç½® (metric_thresholds)

```sql
-- å®¢æˆ¶æµå¤±ç‡é–¾å€¼
INSERT INTO metric_thresholds (
    metric_name, display_name, category,
    threshold_value, comparison_operator, severity,
    is_higher_better, alert_message_template
) VALUES (
    'customer_churn_rate',
    'å®¢æˆ¶æµå¤±ç‡',
    'å®¢æˆ¶å¥åº·',
    15.0,              -- è¶…é 15% è§¸ç™¼è­¦å ±
    '>',
    'critical',
    FALSE,
    'å®¢æˆ¶æµå¤±ç‡é”åˆ° %s%%ï¼Œè¶…éè­¦æˆ’å€¼ %s%%'
);

-- å¹³å‡å›æ‡‰æ™‚é–“é–¾å€¼
INSERT INTO metric_thresholds (
    metric_name, display_name, category,
    threshold_value, comparison_operator, severity,
    is_higher_better, alert_message_template
) VALUES (
    'avg_response_time',
    'å¹³å‡å›æ‡‰æ™‚é–“',
    'å®¢æœæ•ˆç‡',
    120.0,             -- è¶…é 120 åˆ†é˜è§¸ç™¼è­¦å ±
    '>',
    'warning',
    FALSE,
    'å¹³å‡å›æ‡‰æ™‚é–“ %s åˆ†é˜ï¼Œè¶…éæ¨™æº– %s åˆ†é˜'
);

-- è¨‚å–®å®Œæˆç‡é–¾å€¼
INSERT INTO metric_thresholds (
    metric_name, display_name, category,
    threshold_value, comparison_operator, severity,
    is_higher_better, alert_message_template
) VALUES (
    'order_completion_rate',
    'è¨‚å–®å®Œæˆç‡',
    'ç‡Ÿé‹æ•ˆç‡',
    85.0,              -- ä½æ–¼ 85% è§¸ç™¼è­¦å ±
    '<',
    'warning',
    TRUE,
    'è¨‚å–®å®Œæˆç‡ %s%%ï¼Œä½æ–¼æ¨™æº– %s%%'
);

-- åº«å­˜ç¼ºè²¨æ•¸é‡é–¾å€¼
INSERT INTO metric_thresholds (
    metric_name, display_name, category,
    threshold_value, comparison_operator, severity,
    is_higher_better, alert_message_template
) VALUES (
    'inventory_stockout_count',
    'ç¼ºè²¨å•†å“æ•¸é‡',
    'åº«å­˜ç®¡ç†',
    3.0,               -- è¶…é 3 ä»¶è§¸ç™¼è­¦å ±
    '>',
    'warning',
    FALSE,
    'ç¼ºè²¨å•†å“æ•¸é‡ %s ä»¶ï¼Œè¶…éè­¦æˆ’å€¼ %s ä»¶'
);
```

### å¥åº·åº¦è©•åˆ†é…ç½®

```typescript
// Edge Function å…§éƒ¨é…ç½®
const HEALTH_SCORE_WEIGHTS = {
  customerQuality: 0.4,        // å®¢æˆ¶å“è³ªæ¬Šé‡ 40%
  operationalEfficiency: 0.35, // ç‡Ÿé‹æ•ˆç‡æ¬Šé‡ 35%
  supportEffectiveness: 0.25   // å®¢æœæ•ˆèƒ½æ¬Šé‡ 25%
}

const SYSTEM_STABILITY_WEIGHTS = {
  notificationModule: 1.5,     // é€šçŸ¥ç³»çµ±æ¬Šé‡ (æœ€é‡è¦)
  orderModule: 2.0,            // è¨‚å–®ç³»çµ±æ¬Šé‡ (æ ¸å¿ƒæ¥­å‹™)
  inventoryModule: 1.2         // åº«å­˜ç³»çµ±æ¬Šé‡ (æ”¯æ´åŠŸèƒ½)
}

const RATING_THRESHOLDS = {
  excellent: 90,   // å„ªç§€
  good: 75,        // è‰¯å¥½
  normal: 60,      // æ™®é€š
  needImprove: 40  // éœ€æ”¹å–„
  // < 40 = å¾…åŠ å¼·
}
```

### æ´å¯Ÿç”Ÿæˆåƒæ•¸

```typescript
const INSIGHT_GENERATION_CONFIG = {
  maxInsights: 5,                    // æœ€å¤šè¿”å›æ´å¯Ÿæ•¸
  overallScoreExcellent: 90,         // å„ªç•°é–€æª»
  overallScorePoor: 60,              // å¾…æ”¹å–„é–€æª»
  systemStabilityWarning: 7.0,       // ç³»çµ±ç©©å®šåº¦è­¦å‘Šé–€æª»
  trendChangeSignificant: 5,         // é¡¯è‘—è¶¨å‹¢è®ŠåŒ–é–€æª» (%)
  trendChangeStrong: 10,             // å¼·å‹è¶¨å‹¢è®ŠåŒ–é–€æª» (%)
  supportHealthWarning: 5.0,         // å®¢æœå¥åº·åº¦è­¦å‘Šé–€æª»
  revenueHealthWarning: 6.0,         // ç‡Ÿæ”¶å¥åº·åº¦è­¦å‘Šé–€æª»
  confidenceThresholds: {
    high: 0.85,
    medium: 0.75,
    low: 0.65
  }
}
```

---

## ğŸ“ˆ æ•ˆèƒ½èˆ‡å„ªåŒ–

### å¿«å–ç­–ç•¥

#### Query å±¤å¿«å–

```typescript
// Phase 2 Edge Function (æ¥­å‹™æ´å¯Ÿ)
staleTime: 5 * 60 * 1000   // 5 åˆ†é˜å…§ä¸é‡æ–°è«‹æ±‚
gcTime: 10 * 60 * 1000     // 10 åˆ†é˜å¾Œæ¸…é™¤å¿«å–

// Phase 1.5 Database Functions (è­¦ç¤º+å»ºè­°)
staleTime: 2 * 60 * 1000   // 2 åˆ†é˜å…§ä¸é‡æ–°è«‹æ±‚
gcTime: 5 * 60 * 1000      // 5 åˆ†é˜å¾Œæ¸…é™¤å¿«å–
```

#### Edge Function å…§éƒ¨å„ªåŒ–

```typescript
// ä¸¦è¡Œè¨ˆç®—å¤šå€‹æŒ‡æ¨™
const [metrics, scoreDetails, trends] = await Promise.all([
  calculateBusinessHealthMetrics(supabase, period),
  calculateDetailedHealthScores(supabase, period),
  includeTrends ? calculateTrendAnalysis(supabase, period) : null
])
```

### è³‡æ–™åº«æŸ¥è©¢å„ªåŒ–

#### ä½¿ç”¨é å…ˆè¨ˆç®—çš„è¦–åœ–

```sql
-- å·²å„ªåŒ–çš„è¦–åœ–
- user_rfm_lifecycle_metrics       (RFM åˆ†æ)
- conversation_summary_daily       (å®¢æœæ‘˜è¦)
- order_basic_summary              (è¨‚å–®æ‘˜è¦)
- inventory_health_summary         (åº«å­˜å¥åº·åº¦)

-- ç´¢å¼•å„ªåŒ–
CREATE INDEX idx_dashboard_alerts_active
ON dashboard_alerts (is_active, is_resolved, severity, detected_at DESC)
WHERE is_active = TRUE;

CREATE INDEX idx_metric_thresholds_lookup
ON metric_thresholds (metric_name, is_active)
WHERE is_active = TRUE;
```

### å‰ç«¯æ¸²æŸ“å„ªåŒ–

#### æ‡¶è¼‰å…¥åœ–è¡¨çµ„ä»¶

```typescript
// æ‡¶è¼‰å…¥åˆ†æåœ–è¡¨ä»¥æå‡é¦–å±è¼‰å…¥æ•ˆèƒ½
const HealthTrendChart = defineAsyncComponent(() =>
  import('@/components/charts/pure/HealthTrendChart.vue')
)
const HealthComparisonChart = defineAsyncComponent(() =>
  import('@/components/insights/health/HealthComparisonChart.vue')
)
const RiskDistributionChart = defineAsyncComponent(() =>
  import('@/components/charts/pure/RiskDistributionChart.vue')
)
```

#### æ¢ä»¶æ¸²æŸ“èˆ‡è™›æ“¬æ»¾å‹•

```vue
<!-- åƒ…åœ¨æœ‰æ•¸æ“šæ™‚æ¸²æŸ“ -->
<div v-if="!protectedHealthQuery.isLoading.value && insights.length > 0">
  <!-- æ´å¯Ÿå¡ç‰‡åˆ—è¡¨ -->
</div>

<!-- ç©ºç‹€æ…‹è™•ç† -->
<div v-else-if="!protectedHealthQuery.isLoading.value && insights.length === 0">
  <Alert>ç³»çµ±é‹è¡Œæ­£å¸¸ï¼Œæš«ç„¡ç‰¹åˆ¥æ´å¯Ÿ</Alert>
</div>
```

---

## ğŸ§ª æ¸¬è©¦èˆ‡é©—è­‰

### Edge Function æ¸¬è©¦

#### å–®å…ƒæ¸¬è©¦ç¯„ä¾‹

```typescript
// business-health-analytics.test.ts
describe('generateBusinessInsights', () => {
  it('should generate excellence insight when score >= 90', () => {
    const metrics = createMockMetrics({ revenue: 9.5, support: 9.0 })
    const scoreDetails = { overallScore: 92, rating: 'å„ªç§€' }

    const insights = generateBusinessInsights(metrics, scoreDetails, null)

    expect(insights).toHaveLength(1)
    expect(insights[0].title).toBe('æ¥­å‹™è¡¨ç¾å„ªç•°')
    expect(insights[0].type).toBe('opportunity')
    expect(insights[0].confidence).toBe(0.95)
  })

  it('should generate warning insight when score <= 60', () => {
    const metrics = createMockMetrics({ revenue: 4.5, support: 5.5 })
    const scoreDetails = { overallScore: 55, rating: 'éœ€æ”¹å–„' }

    const insights = generateBusinessInsights(metrics, scoreDetails, null)

    expect(insights[0].title).toBe('æ¥­å‹™å¥åº·åº¦éœ€æ”¹å–„')
    expect(insights[0].type).toBe('warning')
    expect(insights[0].impact).toBe('high')
  })

  it('should limit insights to maximum 5', () => {
    const metrics = createMockMetrics({
      revenue: 5.0, support: 4.5, system: 6.5
    })
    const scoreDetails = { overallScore: 55, rating: 'éœ€æ”¹å–„' }
    const trends = { direction: 'ä¸‹é™', change: 8.0 }

    const insights = generateBusinessInsights(metrics, scoreDetails, trends)

    expect(insights.length).toBeLessThanOrEqual(5)
  })
})
```

### è³‡æ–™åº«å‡½æ•¸æ¸¬è©¦

#### SQL æ¸¬è©¦è…³æœ¬

```sql
-- æ¸¬è©¦è­¦å ±ç”Ÿæˆå‡½æ•¸
BEGIN;
  -- æ’å…¥æ¸¬è©¦é–¾å€¼
  INSERT INTO metric_thresholds (metric_name, threshold_value, comparison_operator, severity)
  VALUES ('test_metric', 100, '>', 'warning');

  -- åŸ·è¡Œè­¦å ±ç”Ÿæˆ
  SELECT * FROM generate_dashboard_alerts();

  -- é©—è­‰çµæœ
  SELECT COUNT(*) as alert_count FROM dashboard_alerts WHERE metric_name = 'test_metric';

  -- é æœŸ: alert_count > 0 (å¦‚æœæœ‰è¶…éé–¾å€¼çš„æ•¸æ“š)
ROLLBACK;

-- æ¸¬è©¦å»ºè­°ç”Ÿæˆå‡½æ•¸
BEGIN;
  -- æ’å…¥æ¸¬è©¦è­¦å ±
  INSERT INTO dashboard_alerts (
    metric_name, severity, current_value, is_active, is_resolved
  ) VALUES ('customer_churn_rate', 'critical', 18.5, TRUE, FALSE);

  -- åŸ·è¡Œå»ºè­°ç”Ÿæˆ
  SELECT * FROM generate_strategic_recommendations();

  -- é©—è­‰çµæœ
  SELECT recommendation_type, priority_score, impact_level
  FROM generate_strategic_recommendations()
  WHERE recommendation_type = 'customer_retention';

  -- é æœŸ: priority_score = 95, impact_level = 'high'
ROLLBACK;
```

### æ•´åˆæ¸¬è©¦

#### E2E æ¸¬è©¦å ´æ™¯

```typescript
// e2e/dashboard-executive-health.spec.ts
describe('Dashboard Executive Health', () => {
  it('should display business insights when data is available', async () => {
    await page.goto('/dashboard/executive-health')

    // ç­‰å¾… Edge Function å›æ‡‰
    await page.waitForSelector('[data-testid="business-insights"]')

    // é©—è­‰æ´å¯Ÿå¡ç‰‡é¡¯ç¤º
    const insightCards = await page.$$('[data-testid="insight-card"]')
    expect(insightCards.length).toBeGreaterThan(0)

    // é©—è­‰æ´å¯Ÿå…§å®¹
    const firstInsight = await page.$eval(
      '[data-testid="insight-card"]:first-child h4',
      el => el.textContent
    )
    expect(firstInsight).toBeTruthy()
  })

  it('should display risk alerts with correct priority sorting', async () => {
    await page.goto('/dashboard/executive-health')

    await page.waitForSelector('[data-testid="risk-alerts"]')

    const alertTypes = await page.$$eval(
      '[data-testid="alert-item"] [data-alert-type]',
      els => els.map(el => el.getAttribute('data-alert-type'))
    )

    // é©—è­‰æ’åº: error > warning > info > success
    const priorityOrder = ['error', 'warning', 'info', 'success']
    let lastPriority = -1

    alertTypes.forEach(type => {
      const currentPriority = priorityOrder.indexOf(type)
      expect(currentPriority).toBeGreaterThanOrEqual(lastPriority)
      lastPriority = currentPriority
    })
  })

  it('should display strategic recommendations based on alerts', async () => {
    await page.goto('/dashboard/executive-health')

    await page.waitForSelector('[data-testid="recommendations"]')

    const recommendations = await page.$$('[data-testid="recommendation-item"]')
    expect(recommendations.length).toBeGreaterThan(0)

    // é©—è­‰å»ºè­°åŒ…å«æ™‚é–“è»¸
    const timeline = await page.$eval(
      '[data-testid="recommendation-item"]:first-child [data-testid="timeline"]',
      el => el.textContent
    )
    expect(timeline).toMatch(/é€±|å€‹æœˆ/)
  })
})
```

---

## ğŸ”® æœªä¾†æ“´å±•è¦åŠƒ

### Phase 3: é€²éšåŠŸèƒ½

1. **é æ¸¬æ€§è­¦å ±**
   - åŸºæ–¼æ­·å²è¶¨å‹¢é æ¸¬æœªä¾†é¢¨éšª
   - æ©Ÿå™¨å­¸ç¿’æ¨¡å‹æ•´åˆ
   - ç•°å¸¸æª¢æ¸¬æ¼”ç®—æ³•

2. **è‡ªå®šç¾©é–¾å€¼**
   - ä½¿ç”¨è€…å¯èª¿æ•´è­¦å ±é–¾å€¼
   - è¡Œæ¥­åŸºæº–æ¯”å°
   - A/B æ¸¬è©¦é–¾å€¼å„ªåŒ–

3. **è­¦å ±æ™ºèƒ½åˆ†ç¾¤**
   - ç›¸é—œè­¦å ±è‡ªå‹•åˆ†çµ„
   - æ ¹å› åˆ†æ
   - é€£é–å½±éŸ¿é æ¸¬

4. **å»ºè­°å„ªå…ˆç´šå‹•æ…‹èª¿æ•´**
   - åŸºæ–¼è³‡æºå¯ç”¨æ€§èª¿æ•´å»ºè­°
   - ROI è‡ªå‹•è¨ˆç®—
   - æˆæœ¬æ•ˆç›Šåˆ†ææ•´åˆ

### æŠ€è¡“å‚µå‹™æ¸…ç†

1. **æ–‡ä»¶è£œå¼·**
   - API ç«¯é»å®Œæ•´è¦æ ¼æ–‡ä»¶
   - æ¥­å‹™è¦å‰‡å°ç…§è¡¨
   - æ¡ˆä¾‹ç ”ç©¶èˆ‡æœ€ä½³å¯¦è¸

2. **æ¸¬è©¦è¦†è“‹æå‡**
   - Edge Function å–®å…ƒæ¸¬è©¦ (ç›®æ¨™ 90%+)
   - è³‡æ–™åº«å‡½æ•¸é›†æˆæ¸¬è©¦
   - E2E æ¸¬è©¦å ´æ™¯æ“´å±•

3. **æ•ˆèƒ½ç›£æ§**
   - Edge Function åŸ·è¡Œæ™‚é–“è¿½è¹¤
   - è³‡æ–™åº«æŸ¥è©¢æ•ˆèƒ½åˆ†æ
   - å‰ç«¯æ¸²æŸ“æ•ˆèƒ½å„ªåŒ–

---

## ç›¸é—œæ–‡ä»¶é€£çµ

- [Dashboard åˆ†ææ–‡ä»¶](./dashboard-analysis-documentation.md)
- [Edge Function é·ç§»è©•ä¼°](../../04-guides/dev-notes/EDGE_FUNCTION_MIGRATION_ASSESSMENT.md)
- [AI å¢å¼·è­¦å ±ç³»çµ±](../../04-guides/dev-notes/AI_ENHANCED_ALERT_SYSTEM_SPECIFICATION.md)
- [Realtime éŒ¯èª¤å›å ±å„ªåŒ–](../../04-guides/dev-notes/REALTIME_ERROR_REPORTING_OPTIMIZATION.md)
- [æ¥­å‹™æ¨¡çµ„æ–‡ä»¶](./business-modules.md)

---

## è®Šæ›´æ­·å²

| æ—¥æœŸ | ç‰ˆæœ¬ | è®Šæ›´å…§å®¹ | ä½œè€… |
|------|------|---------|------|
| 2025-10-01 | 1.0.0 | åˆå§‹ç‰ˆæœ¬å»ºç«‹ | Claude Code |

---

## è²¢ç»æŒ‡å—

å¦‚éœ€æ›´æ–°æ­¤æ–‡ä»¶ï¼Œè«‹éµå¾ªä»¥ä¸‹åŸå‰‡ï¼š

1. ä¿æŒæ¼”ç®—æ³•æè¿°çš„æº–ç¢ºæ€§ï¼Œèˆ‡å¯¦éš›ç¨‹å¼ç¢¼ä¸€è‡´
2. æ›´æ–°ç¯„ä¾‹æ™‚ä½¿ç”¨çœŸå¯¦çš„æ¥­å‹™å ´æ™¯
3. æ–°å¢é…ç½®åƒæ•¸æ™‚èªªæ˜èª¿æ•´ç†ç”±
4. æ•ˆèƒ½å„ªåŒ–éœ€æä¾›å‰å¾Œå°æ¯”æ•¸æ“š
5. æ‰€æœ‰è®Šæ›´éœ€æ›´æ–°ã€Œè®Šæ›´æ­·å²ã€å€å¡Š

---

**æ–‡ä»¶ç¶­è­·è€…**: é–‹ç™¼åœ˜éšŠ
**æœ€å¾Œå¯©é–±**: 2025-10-01
**ä¸‹æ¬¡å¯©é–±**: 2025-11-01 (æˆ–é‡å¤§åŠŸèƒ½è®Šæ›´æ™‚)