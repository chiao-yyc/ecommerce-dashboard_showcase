
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ” Supabase RLS æ”¿ç­–ç¨½æ ¸å ±å‘Š
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸš¨ æª¢æŸ¥ 1: æœªå•Ÿç”¨ RLS çš„è³‡æ–™è¡¨
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

 Schema | è³‡æ–™è¡¨åç¨± | è¡¨é¡å‹ | RLSå·²å•Ÿç”¨ 
--------+------------+--------+-----------
(0 rows)


é æœŸçµæœ: åƒ…æœ‰ Views å’Œç³»çµ±è¡¨æ‡‰è©²æœªå•Ÿç”¨ RLS


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸš¨ æª¢æŸ¥ 2: å·²å•Ÿç”¨ RLS ä½†ç„¡æ”¿ç­–çš„è³‡æ–™è¡¨
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

 Schema | è³‡æ–™è¡¨åç¨± | RLSå·²å•Ÿç”¨ | æ”¿ç­–æ•¸é‡ 
--------+------------+-----------+----------
(0 rows)


é æœŸçµæœ: ç„¡è³‡æ–™è¡¨ï¼ˆæ‰€æœ‰å•Ÿç”¨ RLS çš„è¡¨éƒ½æ‡‰æœ‰æ”¿ç­–ï¼‰


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âš ï¸ æª¢æŸ¥ 3: å…è¨±åŒ¿åï¼ˆanonï¼‰å­˜å–çš„æ”¿ç­–
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

 Schema | è³‡æ–™è¡¨åç¨± | æ”¿ç­–åç¨± | æ“ä½œé¡å‹ | é©ç”¨è§’è‰² 
--------+------------+----------+----------+----------
(0 rows)


é æœŸçµæœ: ç„¡æ”¿ç­–ï¼ˆå¾Œå°ç®¡ç†ç³»çµ±ä¸æ‡‰å…è¨±åŒ¿åå­˜å–ï¼‰


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âš ï¸ æª¢æŸ¥ 4: ç„¡æ¢ä»¶å…è¨±çš„æ”¿ç­– (USING true)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

 Schema |           è³‡æ–™è¡¨åç¨±            |                     æ”¿ç­–åç¨±                      | æ“ä½œé¡å‹ |   å­˜å–æ§åˆ¶   | USING æ¢ä»¶ 
--------+---------------------------------+---------------------------------------------------+----------+--------------+------------
 public | agent_assignments               | agent_assignments_select_all                      | SELECT   | âš ï¸ ç„¡æ¢ä»¶å…è¨± | true
 public | ai_system_audit_log             | ai_system_audit_log_select_all                    | SELECT   | âš ï¸ ç„¡æ¢ä»¶å…è¨± | true
 public | alert_content_templates         | Allow authenticated users to read alert templates | SELECT   | âš ï¸ ç„¡æ¢ä»¶å…è¨± | true
 public | conversation_assignment_history | conversation_assignment_history_select_all        | SELECT   | âš ï¸ ç„¡æ¢ä»¶å…è¨± | true
 public | dashboard_alerts                | è­¦ç¤ºå¯æŸ¥çœ‹                                        | SELECT   | âš ï¸ ç„¡æ¢ä»¶å…è¨± | true
 public | default_avatars                 | default_avatars_select_all                        | SELECT   | âš ï¸ ç„¡æ¢ä»¶å…è¨± | true
 public | dim_date                        | dim_date_select_all                               | SELECT   | âš ï¸ ç„¡æ¢ä»¶å…è¨± | true
 public | events                          | events_select_all                                 | SELECT   | âš ï¸ ç„¡æ¢ä»¶å…è¨± | true
 public | funnel_events                   | funnel_events_select_all                          | SELECT   | âš ï¸ ç„¡æ¢ä»¶å…è¨± | true
 public | holidays                        | holidays_select_all                               | SELECT   | âš ï¸ ç„¡æ¢ä»¶å…è¨± | true
 public | metric_thresholds               | é–¾å€¼é…ç½®å¯æŸ¥çœ‹                                    | SELECT   | âš ï¸ ç„¡æ¢ä»¶å…è¨± | true
 public | order_items_jsonb_audit         | order_items_jsonb_audit_select_all                | SELECT   | âš ï¸ ç„¡æ¢ä»¶å…è¨± | true
 public | orders_jsonb_audit              | orders_jsonb_audit_select_all                     | SELECT   | âš ï¸ ç„¡æ¢ä»¶å…è¨± | true
 public | payments                        | payments_select_all                               | SELECT   | âš ï¸ ç„¡æ¢ä»¶å…è¨± | true
 public | role_audit_log                  | role_audit_log_select_all                         | SELECT   | âš ï¸ ç„¡æ¢ä»¶å…è¨± | true
 public | sku_attribute_codes             | sku_attribute_codes_select_all                    | SELECT   | âš ï¸ ç„¡æ¢ä»¶å…è¨± | true
 public | sku_generation_rules            | sku_generation_rules_select_all                   | SELECT   | âš ï¸ ç„¡æ¢ä»¶å…è¨± | true
 public | system_settings                 | system_settings_select_all                        | SELECT   | âš ï¸ ç„¡æ¢ä»¶å…è¨± | true
 public | user_sessions                   | user_sessions_select_all                          | SELECT   | âš ï¸ ç„¡æ¢ä»¶å…è¨± | true
(19 rows)


èªªæ˜: æª¢æŸ¥å“ªäº›è¡¨å…è¨±æ‰€æœ‰ authenticated ç”¨æˆ¶ç„¡æ¢ä»¶è®€å–
      Reference Data å’Œ Audit Logs å¯ä»¥æ˜¯ trueï¼ˆé æœŸè¡Œç‚ºï¼‰


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ” æª¢æŸ¥ 5: æ•æ„Ÿè³‡æ–™è¡¨çš„ RLS æ”¿ç­–
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  æ•æ„Ÿè³‡æ–™è¡¨   | RLSå·²å•Ÿç”¨ | æ”¿ç­–æ•¸é‡ |   å®‰å…¨ç‹€æ…‹   
---------------+-----------+----------+--------------
 payments      | t         |        1 | âš ï¸ æ”¿ç­–ä¸å®Œæ•´
 conversations | t         |        4 | âœ… æ”¿ç­–å®Œæ•´
 customers     | t         |        4 | âœ… æ”¿ç­–å®Œæ•´
 inventories   | t         |        4 | âœ… æ”¿ç­–å®Œæ•´
 messages      | t         |        4 | âœ… æ”¿ç­–å®Œæ•´
 notifications | t         |        4 | âœ… æ”¿ç­–å®Œæ•´
 order_items   | t         |        4 | âœ… æ”¿ç­–å®Œæ•´
 orders        | t         |        5 | âœ… æ”¿ç­–å®Œæ•´
 products      | t         |        4 | âœ… æ”¿ç­–å®Œæ•´
 users         | t         |        4 | âœ… æ”¿ç­–å®Œæ•´
(10 rows)


é æœŸçµæœ: æ‰€æœ‰æ•æ„Ÿè¡¨æ‡‰è©²å•Ÿç”¨ RLS ä¸¦æœ‰ 4 å€‹æ”¿ç­– (SELECT, INSERT, UPDATE, DELETE)


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ”‘ æª¢æŸ¥ 6: æ¬Šé™ç³»çµ±æ•´åˆé©—è­‰
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

         è³‡æ–™è¡¨åç¨±         | æ”¿ç­–æ•¸é‡ | ä½¿ç”¨æ¬Šé™æª¢æŸ¥ | æ•´åˆç‹€æ…‹ 
----------------------------+----------+--------------+----------
 ai_models                  |        4 | t            | âœ… å·²æ•´åˆ
 ai_provider_credentials    |        4 | t            | âœ… å·²æ•´åˆ
 ai_providers               |        4 | t            | âœ… å·²æ•´åˆ
 ai_usage_logs              |        2 | t            | âœ… å·²æ•´åˆ
 campaign_type_config       |        4 | t            | âœ… å·²æ•´åˆ
 campaigns                  |        4 | t            | âœ… å·²æ•´åˆ
 categories                 |        4 | t            | âœ… å·²æ•´åˆ
 conversations              |        4 | t            | âœ… å·²æ•´åˆ
 customers                  |        4 | t            | âœ… å·²æ•´åˆ
 inventories                |        4 | t            | âœ… å·²æ•´åˆ
 inventory_logs             |        2 | t            | âœ… å·²æ•´åˆ
 messages                   |        4 | t            | âœ… å·²æ•´åˆ
 notification_distributions |        4 | t            | âœ… å·²æ•´åˆ
 notification_groups        |        4 | t            | âœ… å·²æ•´åˆ
 notification_logs          |        2 | t            | âœ… å·²æ•´åˆ
 notification_preferences   |        4 | t            | âœ… å·²æ•´åˆ
 notification_recipients    |        4 | t            | âœ… å·²æ•´åˆ
 notification_routing_rules |        4 | t            | âœ… å·²æ•´åˆ
 notification_templates     |        4 | t            | âœ… å·²æ•´åˆ
 notifications              |        4 | t            | âœ… å·²æ•´åˆ
 order_items                |        4 | t            | âœ… å·²æ•´åˆ
 orders                     |        5 | t            | âœ… å·²æ•´åˆ
 permission_groups          |        4 | t            | âœ… å·²æ•´åˆ
 permissions                |        4 | t            | âœ… å·²æ•´åˆ
 products                   |        4 | t            | âœ… å·²æ•´åˆ
 role_permissions           |        3 | t            | âœ… å·²æ•´åˆ
 roles                      |        4 | t            | âœ… å·²æ•´åˆ
 tickets                    |        4 | t            | âœ… å·²æ•´åˆ
 user_roles                 |        3 | t            | âœ… å·²æ•´åˆ
 users                      |        4 | t            | âœ… å·²æ•´åˆ
 ai_prompt_provider_configs |        2 | f            | âš ï¸ æœªæ•´åˆ
 ai_prompt_templates        |        2 | f            | âš ï¸ æœªæ•´åˆ
 ai_system_config           |        1 | f            | âš ï¸ æœªæ•´åˆ
 alert_content_templates    |        2 | f            | âš ï¸ æœªæ•´åˆ
 dashboard_alerts           |        2 | f            | âš ï¸ æœªæ•´åˆ
 dim_date                   |        1 | f            | âš ï¸ æœªæ•´åˆ
 events                     |        1 | f            | âš ï¸ æœªæ•´åˆ
 funnel_events              |        1 | f            | âš ï¸ æœªæ•´åˆ
 metric_thresholds          |        2 | f            | âš ï¸ æœªæ•´åˆ
 payments                   |        1 | f            | âš ï¸ æœªæ•´åˆ
 system_settings            |        1 | f            | âš ï¸ æœªæ•´åˆ
(41 rows)


èªªæ˜: æ¥­å‹™è¡¨æ‡‰è©²ä½¿ç”¨ has_permission() å‡½æ•¸é€²è¡Œæ¬Šé™æ§åˆ¶
      Reference/Audit/System è¡¨å¯ä»¥ä½¿ç”¨ç°¡å–®çš„ authenticated æª¢æŸ¥


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ›¡ï¸ æª¢æŸ¥ 7: Super Admin ä¿è­·æ©Ÿåˆ¶
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

           æ”¿ç­–åç¨±            | æ“ä½œé¡å‹ | Super Admin ä¿è­· |                                                                                 USING æ¢ä»¶                                                                                  
-------------------------------+----------+------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 users_delete_with_protections | DELETE   | âœ… æœ‰ä¿è­·         | ((email <> 'system@internal.system'::text) AND has_permission(auth.uid(), 'role.user.manage'::text) AND (NOT is_target_super_admin(id)) AND (id <> ( SELECT users_1.id     +
                               |          |                  |    FROM users users_1                                                                                                                                                      +
                               |          |                  |   WHERE (users_1.auth_user_id = auth.uid()))))
 users_update_with_protections | UPDATE   | âœ… æœ‰ä¿è­·         | ((email <> 'system@internal.system'::text) AND ((auth_user_id = auth.uid()) OR (has_permission(auth.uid(), 'role.user.manage'::text) AND (NOT is_target_super_admin(id)))))
(2 rows)


é æœŸçµæœ: users è¡¨çš„ UPDATE å’Œ DELETE æ”¿ç­–æ‡‰è©²åŒ…å« Super Admin ä¿è­·


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ›¡ï¸ æª¢æŸ¥ 8: ç³»çµ±ç”¨æˆ¶ï¼ˆsystem@internal.systemï¼‰ä¿è­·æ©Ÿåˆ¶
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

               æ”¿ç­–åç¨±               | æ“ä½œé¡å‹ | ç³»çµ±ç”¨æˆ¶ä¿è­· |                                   USING æ¢ä»¶æ‘˜è¦                                    
--------------------------------------+----------+--------------+-------------------------------------------------------------------------------------
 users_delete_with_protections        | DELETE   | âœ… æœ‰ä¿è­·     | ((email <> 'system@internal.system'::text) AND has_permission(auth.uid(), 'role....
 users_insert_self                    | INSERT   | âŒ ç„¡ä¿è­·     | 
 users_select_self_or_with_permission | SELECT   | âœ… æœ‰ä¿è­·     | ((email <> 'system@internal.system'::text) AND ((auth_user_id = auth.uid()) OR h...
 users_update_with_protections        | UPDATE   | âœ… æœ‰ä¿è­·     | ((email <> 'system@internal.system'::text) AND ((auth_user_id = auth.uid()) OR (...
(4 rows)


é æœŸçµæœ: users è¡¨çš„æ‰€æœ‰æ“ä½œéƒ½æ‡‰è©²æ’é™¤ system@internal.system


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“Š æª¢æŸ¥ 9: RLS é…ç½®çµ±è¨ˆæ‘˜è¦
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

 ç¸½è³‡æ–™è¡¨æ•¸ | å·²å•Ÿç”¨ RLS | æœªå•Ÿç”¨ RLS | æœ‰æ”¿ç­–çš„è¡¨ | ç¸½æ”¿ç­–æ•¸ | RLS è¦†è“‹ç‡ 
------------+------------+------------+------------+----------+------------
         52 |         52 |          0 |         52 |      140 | 100.00%
(1 row)


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âœ… ç¨½æ ¸å ±å‘Šå®Œæˆ
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

